<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Folder</title>
        <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<style>
    .grade-chart {
        width: 200px;
        height: 200px;
    }
</style>
<body>

    <h1>Folder: {{ folder.name }}</h1>

    <!-- Display flashed messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="alert alert-{{ messages[0][0] }}">
                {{ messages[0][1] }}
            </div>
        {% endif %}
    {% endwith %}

    <div class="grade-chart" id="gradeChart-container">
        <canvas id="gradeChart" class="grade-chart"></canvas>
        <p>Number of Flashcards: {{ flashcards|length }}</p>
        <button class="download-button" onclick="downloadGradeChart()">Download Grade Chart</button>
    </div>

    <!-- A button to study the flashcards -->
    <form method="GET" action="{{ url_for('study_flashcards', folder_id=folder.id) }}">
        <button type="submit" class="btn btn-link">Study Flashcards</button>
    </form>

    <!-- A button to quiz the flashcards -->
    <form method="GET" action="{{ url_for('quiz_flashcards', folder_id=folder.id) }}">
        <button type="submit" class="btn btn-link">Start Quiz</button>
    </form>

    <h2>Flashcards in This Folder</h2>
    <table>
        <thead>
            <tr>
                <th>Question</th>
                <th>Answer</th>
            </tr>
        </thead>
        <tbody>
            {% for flashcard in flashcards %}
            <tr>
                <td>{{ flashcard.question }}</td>
                <td>{{ flashcard.answer }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

        <!-- Change Color Dropdown -->
    <form method="POST" action="/change_folder_color/{{ folder.id }}">
        <label for="new_color">Change Color:</label>
        <select name="new_color">
            <option value="red">Red</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
            <option value="yellow">Yellow</option>
            <option value="orange">Orange</option>
        </select>
        <input type="submit" value="Change Color">
    </form>

    <!-- Change Name Form -->
    <form method="POST" action="/change_folder_name/{{ folder.id }}">
        <label for="new_name">Change Name:</label>
        <input type="text" name="new_name" required>
        <input type="submit" value="Change Name">
    </form>

    <!-- Delete Folder Button -->
    <form method="POST" action="/delete_folder/{{ folder.id }}">
        <input type="submit" value="Delete Folder">
    </form>

    <a href="/dashboard">Back to Dashboard</a>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Retrieve the grade (latest_score) from your template
            const grade = {{ folder.latest_score }};

            // Check if grade has a value before displaying the chart
            if (grade !== -1 && grade !== undefined) {
                // Run the function to display the grade as a pie chart
                displayGradeChart(grade);
            }
            else {
                const gradeContainer = document.getElementById('gradeChart-container');
                const gradeCanvas = document.getElementById('gradeChart');

                // Display the container
                gradeContainer.style.display = 'none';
            }
        });

        function displayGradeChart(grade) {
            const gradeContainer = document.getElementById('gradeChart-container');
            const gradeCanvas = document.getElementById('gradeChart');

            const gradeChart = new Chart(gradeCanvas, {
                type: 'pie',
                data: {
                    labels: ['Grade', 'Remaining'],
                    datasets: [{
                        data: [grade, 100 - grade],
                        backgroundColor: ['green', 'gray'],
                    }]
                },
                options: {
                    title: {
                        display: true,
                        text: `Exam Grade: ${grade.toFixed(2)}%`
                    }
                }
            });
        }

        function downloadGradeChart() {
            const gradeCanvas = document.getElementById('gradeChart');
            const dataUrl = gradeCanvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'grade_chart.png';
            link.click();
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
